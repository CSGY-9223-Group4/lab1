# **Secret scan using TruffleHog**
## Key Checks Performed by the Workflow
# Scan for Secrets:
# TruffleHog analyzes the repository's commit history (specifically changes since the last commit) to look for potential secrets. It does this by searching for patterns that typically indicate sensitive data, such as:
# - API keys
# - Passwords
# - Tokens (e.g., OAuth tokens)
# - SSH keys


name: Secret Scan

on: [pull_request]

jobs:
  secret-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install TruffleHog
        run: |
          pip install truffleHog

      - name: Run TruffleHog
        id: trufflehog
        run: |
          trufflehog --json --regex --since_commit HEAD~1 > trufflehog-report.json || true

      - name: Upload TruffleHog report
        uses: actions/upload-artifact@v2
        with:
          name: trufflehog-report
          path: trufflehog-report.json

      - name: Check for secrets in report
        id: check-secrets
        run: |
          if [ -s trufflehog-report.json ]; then
            echo "Secrets found! See trufflehog-report.json for details."
            echo "status=fail" >> $GITHUB_ENV
          else
            echo "No secrets found."
            echo "status=success" >> $GITHUB_ENV
          fi

      - name: Set commit status
        run: |
          curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/${{ github.repository }}/statuses/${{ github.sha }} \
          -d "{\"state\": \"${{ env.status }}\", \"context\": \"ci/secret-scan\"}"

